!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.WolframNotebookEmbedder={})}(this,function(e){"use strict";function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var t=setTimeout;function r(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function o(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void c(r.promise,e)}a(r.promise,t)}else(1===n._state?a:c)(r.promise,n._value)})):n._deferreds.push(r)}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void l((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){c(t,e)}var r,o}function c(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function f(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,a(t,e))},function(e){n||(n=!0,c(t,e))})}catch(e){if(n)return;n=!0,c(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new f(e,t,n)),n},i.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})},i.all=function(t){return new i(function(r,o){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(t);if(0===i.length)return r([]);var a=i.length;function c(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){c(t,e)},o)}i[t]=e,0==--a&&r(i)}catch(e){o(e)}}for(var e=0;e<i.length;e++)c(e,i[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(o){return new i(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object")}().Promise||i,n={},p={},m=0,v=!1,w=[],y=[];function g(e){if(!n[e]){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t),n[e]=!0}}function b(e,t){return void 0===e?t:e}e.embed=function(t,n,e){var u,r,f,o=e||{},i=o.useShadowDOM,l=void 0!==i&&i&&n.attachShadow,a=[n],s=[];function c(e){var t=e.width,n=e.height;a.forEach(function(e){null!=t&&(e.style.width=t+"px"),null!=n&&(e.style.height=n+"px")})}return h.resolve().then(function(){if(l){var e=document.createElement("div");e.style.width="100%",e.style.height="100%",f=e.attachShadow({mode:"open"}),(r=document.createElement("div")).style.width="100%",r.style.height="100%",n.appendChild(e),Object.defineProperty(r,"ownerDocument",{value:f}),f.createElement=function(){var e;return(e=document).createElement.apply(e,arguments)},f.createElementNS=function(){var e;return(e=document).createElementNS.apply(e,arguments)},f.createTextNode=function(){var e;return(e=document).createTextNode.apply(e,arguments)},f.createDocumentFragment=function(){var e;return(e=document).createDocumentFragment.apply(e,arguments)},f.documentElement=r,f.defaultView=window,a.push(e),a.push(r),f.appendChild(r)}else r=n;return function(e){var t=function(e,t){for(var n=null,r=null,o=0;o<t.length;++o){var i=t[o],a=e.indexOf(i);0<=a&&(null===n||a<n.length)&&(n=e.substring(0,a),r=e.substring(a+i.length))}return[n,r]}(e,["/obj/","/objects/"]),i=t[0],n=t[1];if(!i||!n)throw new Error("InvalidCloudObjectURL");var r=n.split("?",1)[0];if(!r)throw new Error("InvalidCloudObjectURL");var a=i+"/notebooks/embedding?path="+r;return new h(function(n,r){var o=new XMLHttpRequest;o.addEventListener("load",function(){if(200===o.status){var e=o.responseText,t=JSON.parse(e);n({notebookID:t.notebookID,mainScript:i+t.mainScript,otherScripts:(t.otherScripts||[]).map(function(e){return i+e}),stylesheetDomains:[i].concat(t.stylesheetDomains)})}else r(new Error("ResolveError"))}),o.addEventListener("error",function(){r(new Error("RequestError"))}),o.addEventListener("abort",function(){r(new Error("RequestAborted"))}),o.open("GET",a),o.send()})}(t)}).then(function(e){var o,t=e.notebookID,n=e.mainScript,r=e.otherScripts,i=e.stylesheetDomains;if(l){var a=function(n,e){function t(e){var t=e.didInsertWithoutCloning?e.cloneNode(!0):e;e.didInsertWithoutCloning=!0,n.appendChild(t)}if(!v){var r=document.getElementsByTagName("head")[0];if(r){var o=r.appendChild;r.appendChild=function(t){!function(t,e){var n=t.tagName.toLowerCase();if("link"===n&&("stylesheet"===t.rel||"text/css"===t.type))return e.some(function(e){return t.href.startsWith(e)});if("style"===n){if(t.dataset.isWolframNotebookStyle)return!0;if("erd_scroll_detection_scrollbar_style"===t.id)return!0}return!1}(t,e)?o.call(this,t):(w.push(t),y.forEach(function(e){e(t)}))}}v=!0}w.forEach(function(e){t(e)}),y.push(t);var i=y.length-1;return function(){y.splice(i,1)}}(f,i);s.push(a)}u=t;for(var c=0;c<r.length;++c)g(r[c]);return p[o=n]||(p[o]=new h(function(t,e){var n,r=document.createElement("script");for(r.type="text/javascript",r.onerror=e;n="_wolframNotebookEmbedderCallback"+ ++m,window[n];);window[n]=function(e){delete window[n],t(e)},r.src=o+"?callback="+n,document.getElementsByTagName("head")[0].appendChild(r)})),p[o]}).then(function(e){return e.embed(u,r,{width:b(o.width,null),maxHeight:b(o.maxHeight,1/0),allowInteract:b(o.allowInteract,!0),showRenderProgress:b(o.showRenderProgress,!0),onContainerDimensionsChange:c})}).then(function(i){return d({},i,{detach:function(){i.detach(),s.forEach(function(e){e()})},setAttributes:function(e){var t=e.width,n=e.maxHeight,r=e.allowInteract,o=e.showRenderProgress;i.setAttributes({width:t,maxHeight:n,allowInteract:r,showRenderProgress:o})}})})},Object.defineProperty(e,"__esModule",{value:!0})});